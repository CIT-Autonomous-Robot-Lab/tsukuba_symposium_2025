% テーブルの太線代替（未定義エラー回避）
\newcommand{\thline}{\hline}

\subsubsection{概要}
きなこチームでは,
自己位置推定にemcl2\_ros2を,
ナビゲーションには自作したkinako\_nav\cite{kinako_nav_github}を採用した.
圧縮した3次元地図の利用と自己位置推定の信頼性向上を目的に,
emcl2\_ros2を拡張した.
具体的には,
圧縮地図の読み出し機能を追加し,
もともと2次元スキャンのみ対応していたemcl2\_ros2を3次元点群に対応させた.
ただし,
3次元の自己位置推定は計算量が大きいため,
自由度は2次元（x, y, yaw）に制限した.
また,
3D LiDARの点群から高さ領域を指定して抽出し,
走行中に使用する高さを切り替える機能を実装した.
これにより,
人が多い場所では地上から離れた高さの点群を使うなど,
場所ごとに特徴的な高さの点群を使い分けられる.

また,
以前はnavigation2を使用していたが,
次の問題があった.
\begin{itemize}
\item 処理が重い
\item システム構成が複雑
\item 他のロボットに近づいてから回避する
\end{itemize}
さらに,
DWBやMPCといったローカルプランナーは候補パスのみを評価している.
つくばチャレンジのように,
どこからでもロボットや人が接近する状況では,
LiDARの計測範囲全体の情報を経路計画に用いたい.
そのため,
軽量かつ直列構成のノードで,
最適性よりも安全な回避を重視したナビゲーションシステムを開発した.

\subsubsection{占有格子地図の圧縮}
まず, 占有格子地図の圧縮を行った.
つくばチャレンジの地図は表\ref{tab:vq_compression_result}に示すように非常に大きい容量を持つ.
地図はGLIM\cite{glim}\cite{glim_github}を用いて3次元で作成し,
点群地図を占有格子地図に変換してから圧縮した.
圧縮にはvq\_occupancy\_compressor\cite{vq_occupancy_compressor_github}を使用した.

\begin{table}[tb]
  \centering
	\caption{Size of VQ map}
  \label{tab:vq_compression_result}
  \small
	\begin{tabular}{lc}
		\\
    \thline
		地図容量 & 30.9GB \\
    \hline
		実環境における規模 & 795.2$\times$523.6$\times$74.2m \\
    \hline
    解像度    & 0.1m/voxel \\
    \thline
  \end{tabular}
\end{table}

圧縮した結果, \ref{tab:compression_result}に示すように,
地図容量は74.6MBとなり, 圧縮率は0.0024となった.
\begin{table}[tb]
  \centering
	\caption{compression result}
  \label{tab:compression_result}
  \small
	\begin{tabular}{lc}
		\\
    \thline
		圧縮地図の容量 & 74.6MB \\
    \hline
		圧縮率 & 0.0024 \\
    \thline
  \end{tabular}
\end{table}


\subsubsection{開発したナビゲーションシステム}
システムの開発のために以下のいくつかのパッケージを作成した.

\begin{itemize}
  \item imu\_rpy\_pose: IMU角速度を積分し, 位置・姿勢を算出
  \item obstacle\_tracker: スキャンをクラスタリングして障害物マスクを生成
  \item pointcloud2\_cutter: ロボットの位置によって自己位置推定に最適な点群を高さ領域で切り出し. ロボットの全高領域はスキャンを生成
  \item waypoint\_manager: ウェイポイントの管理
  \item vector\_field\_planner: ベクトル場でローカル速度指令を生成するプランナ
  \item velocity\_smoother: 速度指令を平滑化
\end{itemize}

\subsubsection{システム統合}
きなこチームのシステム構成を図\ref{fig:kinako_system}, 図\ref{fig:kinako_nav}に示す.
\begin{figure}[h]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{figs/kinako_system.eps}
    \caption{きなこチームのシステム構成}
    \label{fig:kinako_system}
  \end{center}
\end{figure}

\begin{figure}[h]
  \begin{center}
    \includegraphics[width=1.0\linewidth]{figs/kinako_nav.eps}
    \caption{kinako\_navのシステム構成}
    \label{fig:kinako_nav}
  \end{center}
\end{figure}